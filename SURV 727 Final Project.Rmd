---
title: "SURV 727 Final Project"
author: "Mathew Hill"
date: "2024-11-25"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(tidycensus)
library(gtrendsR)
library(censusapi)
library(ggplot2)
library(dplyr)
```

```{r}
search_terms <- c("abortion", "abortion pill", "murder")
timeframe <- "2022-01-01 2022-12-31"


trends_data <- gtrends(keyword = search_terms, time = timeframe, geo = "US-FL")
```

```{r}
interest_over_time <- trends_data$interest_over_time

interest_clean <- interest_over_time %>%
  select(date, keyword, hits) %>%
  mutate(hits = as.numeric(hits)) %>%
  filter(!is.na(hits))


fl_gender_demo <- data.frame(
  county = c("Miami-Dade", "Orange", "Duval", "Leon"),
  women_reproductive_age_pct = c(25, 22, 20, 24)
)

ggplot(interest_clean, aes(x = date, y = hits, color = keyword)) +
  geom_line(linewidth = 1) +
  labs(title = "Abortion-Related Search Trends in Florida",
       subtitle = "Analyzing Gender-Driven Topics Through Proxy Data",
       x = "Date", y = "Search Interest",
       color = "Search Term") +
  theme_minimal()
```

```{r}
full_df <- data.frame(trends_data$interest_over_time) 
```

```{r}
city_df <- data.frame(trends_data$interest_by_city)

abortion_filtered_city_df <- city_df %>%
  filter(keyword == "abortion") #abortion df with cities

roe_v_wade_filtered_city_df <- city_df %>%
  filter(keyword == "roe v wade") #roe v wade df with cities
```

```{r}
cs_key <- trimws(read_file("C:/Users/mathe/OneDrive/Documents/census-key.txt"))
#Reading API key from .txt file

census_api_key(cs_key)
```

```{r}
acs_fl <- getCensus(name = "acs/acs5",
                    vintage = 2022,
                    vars = c(
                      "NAME",                #name of the city
                      "B01001_001E",         #total population
                      "B01001_002E",         #total male population
                      "B01001_026E",         #total female population
                      "B02001_002E",         #white 
                      "B02001_003E",         #black
                      "B02001_004E",         #american indian and alaska native
                      "B02001_005E",         #asian
                      "B02001_006E",         #native hawaiian and other pacific islander
                      "B02001_007E",         #some other race alone
                      "B02001_008E",         #two or more races
                      "B06002_001E",         #median age
                      "B19013_001E",         #median household income
                      "B19301_001E"          #income per capita
                    ),
                    region = "place:*",
                    regionin = "state:12",  #florida (state code 12)
                    key = cs_key)         

head(acs_fl)
```


